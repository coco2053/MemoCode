<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Ubuntu:700|Montserrat:500,700&display=swap" rel="stylesheet">
        <link href="css/prism.css" rel="stylesheet" />
        <link href="css/jquery.loadingModal.min.css" rel="stylesheet" />
        <LINK REL="SHORTCUT ICON" href="{{asset('image/favicon.ico')}}">
        <style>
        @media (max-width:768px) {
            #logo {
                width: 200px;
            }
        }
        article {
            padding: 10px;
        }
            body {
                font-family: 'Montserrat';
            }
            h2 {
                font-size: 18px;
                font-weight: 700;
                line-height: 26px;

            }
            h3 {
                margin-top: 5px;
                margin-bottom: 10px;
                font-size: 22px;
                font-weight: 700;
                line-height: 26px;
            }
            #articles a {
                text-decoration: none;
                color: black;
                width: 100%;
            }
            #articles a:hover .article {
                box-shadow: rgba(0, 0, 0, 0.2) 0px 5px 5px -3px, rgba(0, 0, 0, 0.14) 0px 8px 10px 1px, rgba(0, 0, 0, 0.12) 0px 3px 14px 2px;
                transition: box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
            }
            .article {
                display: flex;
                margin-top: 20px;
                margin-bottom: 20px;
                height: 200px;
                box-shadow: 0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);
            }
            header {
                margin-bottom: 30px;
                box-shadow: rgba(0, 0, 0, 0.2) 0px 2px 4px -1px, rgba(0, 0, 0, 0.14) 0px 4px 5px 0px, rgba(0, 0, 0, 0.12) 0px 1px 10px 0px;
            }
            #logo {
                margin-top: 1px;
                margin-bottom: 0px;
                /*position:absolute;
                bottom: 10px;*/
            }
            .thumbnail {
                overflow: hidden;
                font-family: 'Ubuntu', sans-serif;
                font-size: 30px;
                text-align: center;
                color: white;
                min-width: calc(150px * 1.77777);
                height: 150px;
                background-color: #b470b3;
                display: inline-block;
                position: relative;
                padding: 10px;
                margin: 20px;
            }
            .thumbnail li {
                list-style: none;
            }
            .info {
                margin-right: 10px;
                margin-top: 25px;
                display: inline-block;
                position: relative;
                height: 150px;
                /*background-color: blue;*/
                vertical-align: top;
            }
            .help-block {
                color: red;
            }
            .btn-success {
                margin-top: 20px;
                margin-bottom: 20px;
            }
            .form-check {
                display: inline-block;
                margin: 2px;
                padding: 0px;

            }
            .switch-field {
                display: flex;
                /*margin-bottom: 36px;
                /*overflow: hidden;*/
            }

            .switch-field input {
                position: absolute !important;
                clip: rect(0, 0, 0, 0);
                height: 1px;
                width: 1px;
                border: 0;
                overflow: hidden;
            }

            .switch-field label {
                background-color: #e4e4e4;
                color: rgba(0, 0, 0, 0.6);
                font-size: 14px;
                line-height: 1;
                text-align: center;
                padding: 8px 16px;
                border-radius: 4px;
                box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3), 0 1px rgba(255, 255, 255, 0.1);
                transition: all 0.1s ease-in-out;
            }

            .switch-field label:hover {
                cursor: pointer;
            }

            .switch-field input:checked + label {
                background-color: #a5dc86;
                box-shadow: none;
            }
            #search {

            }
            #search-icon {
                margin-left: 10px;
            }
            #search-input {

            }
            #calendar {
                margin-right: 10px;
            }
            .date {
                font-size: 15px;
                font-weight: 500;
                color: #6c1cc7;
            }
            article .date {
                margin-top: 5px;
            }
            .info {
                box-sizing: border-box;
            }
            .code-toolbar {
                margin-top: 20px;
                margin-bottom: 20px;
            }
            .banner {
                margin-left: 15%;
                margin-right: 15%;
            }
            #user {
                color: #6c1cc7;
            }
            #login {
                margin-top: 20px;
                margin-bottom: 20px;
            }.centered {
                text-align: center;
            }
            .empty {
                margin-top: 150px;
                font-size: 30px;
                text-align: center;
            }
            .no-height {
                height: 0px;
            }
            .add_text, .add_memo {
                margin-bottom: 10px;
            }
            .line {
                display: inline-block;
            }
            .right {
                text-align: right;
            }
            #myPosts {
                margin-left: 5px;
            }
            .bottom {
                vertical-align: bottom;
            }
            #user {
                padding: 0px;
                margin-left: 50px;
            }
            .navbar {
                height: 100px;
            }
            .modal-btn {
                background-color: #6c1cc7;
            }
            .article {
                overflow: hidden;
            }
            #error {
                margin-top: 10px;
            }
        </style>
        <title>{% block title %}Welcome!{% endblock %}</title>
        {% block stylesheets %}{% endblock %}
    </head>
    <body>
        <header>
        <!-- Navigation -->
        <nav class="navbar navbar-expand-md">
            <div class="container">
                <div class="bottom">
                <img id="logo" src="{{asset('image/logo.svg')}}" width="300px"/>
            </div>
                <div>

                    {{ include("theme/form_search.html.twig") }}
                    <div class="btn-group">
                        <button type="button" id="user" class="btn dropdown no-padding" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-user fa-3x" aria-hidden="true"></i>
                        {% if app.user %}
                            <div>{{ app.user.username }}</div>
                        {% endif %}
                        </button>
                        <div class="dropdown-menu">
                            {% if app.user %}
                                <a class="dropdown-item" href="{{ path('security_logout')}}">Se deconnecter</a>
                            {% else %}
                                <a data-target="{{ path('security_login') }}" class="tooltipped modal-trigger dropdown-item" data-tooltip="Connexion" role="button" href="#addModal">Se connecter</a>
                            {% endif %}
                        </div>
                    </div>
                </div>

            </div>
        </nav>
        </header>
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-2"> </div>
                <div class="col-md-8">
                    {% if app.user %}
                        <a data-target="{{ path('article_add') }}" class="tooltipped modal-trigger btn btn-primary" data-tooltip="Nouvel article" role="button" href="#addModal">Nouvel article</a>
                    {% else %}
                        Il faut être connecté pour écrire un article : <a data-target="{{ path('security_login') }}" class="tooltipped modal-trigger" data-tooltip="Connexion" role="button" href="#addModal">se connecter</a>

                    {% endif %}
                    <!-- Modal de messages -->
                  <div class="modal fade" id="centralModalSm" tabindex="-1"
                       role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                      <div class="modal-content">
                            <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel">Message</h5>
                              <button type="button" class="btn btn-sm btn-secondary modal-btn" data-dismiss="modal"><i class="fas fa-times"></i></button>
                              </button>
                            </div>
                            <div class="modal-body">
                              {% if app.session.flashbag.peekAll|length > 0 %}
                                {% set modalShow = true %}
                                {% for type, messages in app.session.flashbag.all %}
                                    {% for message in messages %}
                                        <div class="{{ type ? type : '' }}">
                                          {{ message|trans({}, domain|default('messages')) }}
                                        </div>
                                    {% endfor %}
                                {% endfor %}
                              {% endif %}
                            </div>
                            <div class="modal-footer">
                            </div>
                      </div>
                    </div>
                  </div>
                    <!-- Modal de contenu -->
                    <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
                        <div id="modal-size" class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 id="modal-title"class="modal-title"></h5>
                                    <div>
                                        <button id="modal-up" type="button" class="btn btn-sm btn-secondary modal-btn"><i class="fas fa-expand-arrows-alt"></i></button>
                                        <button type="button" class="btn btn-sm btn-secondary modal-btn" data-dismiss="modal"><i class="fas fa-times"></i></button>
                                    </div>
                                </div>
                                <div class="modal-body" id="modal-ajax">
                                </div>
                                <div class="modal-footer"></div>
                            </div>
                        </div>
                    </div>
            {% block body %}{% endblock %}
            </div>
            <div class="col-md-2"> </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
              crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    <script src="js/prism.js"></script>
    <script src="js/jquery.loadingModal.min.js"></script>
    <script src="js/bootbox.min.js"></script>
    <script src="js/bootbox.locales.min.js"></script>

      {% if modalShow is defined %}
        <script src="{{ asset("js/showModal.js") }}"></script>
      {% endif %}

        {% block javascripts %}
            <script>
                $(function() {
                    let bool = false;
                    $('#modal-up').click(function () {
                        if (!bool) {
                            $('#modal-size').removeClass("modal-lg");
                            $('#modal-size').addClass("modal-xl");
                        } else {
                            $('#modal-size').removeClass("modal-xl");
                            $('#modal-size').addClass("modal-lg");
                        }
                        bool = !bool;
                        console.log(bool);

                    });

                    $(document).on({
                        ajaxStart: function() { $('body').loadingModal({text: 'chargement...'});    },
                        ajaxStop: function() { $('body').loadingModal('hide'); }
                    });

                    $("#search-input").bind("input focus change", search);

                    $('#addModal').on('show.bs.modal',
                        function(e) {
                        Prism.highlightAllUnder($('#modal-ajax')[0]);
                    });

                    $("body").on("click", ".modal-trigger", function() {
                        //On récupère l'url depuis la propriété "Data-target" de la balise html a
                        jump = $(this).attr('data-jump');
                        if (jump) $('#addModal').modal("hide");

                        url = $(this).attr('data-target');
                        title = $(this).attr('data-tooltip');
                        //on fait un appel ajax vers l'action symfony qui nous renvoie la vue
                        $.get(url, function (data) {
                            //on injecte le html dans la modale
                            $('#modal-ajax').html(data);
                            $('#modal-title').html(title);
                            //On initialise les modales materialize
                            if (jump) {
                                setTimeout("$('#addModal').modal();", 500);
                            } else {
                                $('#addModal').modal();
                            }
                        });
                    });

                    function search(){
                        var search = $("#search-input").val();

                        // Send an ajax request with the user input data
                        $.ajax({
                            type: "POST",
                            url: "{{ path('articles_search') }}",
                            data: {search: search,
                                    'isChecked': $("#myPosts").is(':checked') }
                        })
                        .done(function(data) {
                            //console.log(data);
                            $('#articles').html(data);

                        });
                    }
                    Prism.plugins.NormalizeWhitespace.setDefaults({
                        'remove-trailing': true,
                        'remove-indent': false,
                        'left-trim': false,
                        'right-trim': true,
                        'break-lines': 120,/*
                        'indent': 2,
                        'remove-initial-line-feed': false,
                        'tabs-to-spaces': 4,
                        'spaces-to-tabs': 4*/
                    });
                });
            </script>
        {% endblock %}
    </body>
</html>
